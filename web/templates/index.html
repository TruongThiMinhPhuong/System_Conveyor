<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçé Development of a Conveyor System for Fruit Quality Classification Using AI Camera</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üçé Development of a Conveyor System for Fruit Quality Classification Using AI Camera</h1>
                <p class="subtitle">Raspberry Pi 4 - YOLOv8 + MobileNetV2</p>
            </div>
            <div class="status-indicator">
                <span id="connection-status" class="status-dot offline"></span>
                <span id="connection-text">Offline</span>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-layout">
            <!-- Left Panel: Video Feed -->
            <div class="panel video-panel">
                <div class="panel-header">
                    <h2>üìπ Camera Feed</h2>
                    <span id="fps-indicator" class="badge">0 FPS</span>
                </div>
                <div class="video-container">
                    <img id="video-feed" src="{{ url_for('video_feed') }}" alt="Camera Feed">
                    <div id="video-overlay" class="video-overlay">
                        <div class="loading-spinner"></div>
                        <p>Waiting for feed...</p>
                    </div>
                </div>
                <div class="video-info">
                    <div id="last-detection" class="detection-info">
                        <h3 style="margin-top: 0; margin-bottom: 10px;">üéØ Last Detection</h3>
                        <div id="detection-container" style="display: none;">
                            <div style="display: flex; gap: 15px; align-items: flex-start;">
                                <div id="detection-image-container" style="flex-shrink: 0;">
                                    <img id="detection-image" src="" alt="Detected Fruit"
                                        style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 3px solid #ddd; cursor: pointer;"
                                        onclick="enlargeImage(this.src)">
                                </div>
                                <div style="flex-grow: 1;">
                                    <div id="detection-details" style="font-size: 14px; line-height: 1.8;">
                                        <p style="margin: 5px 0;"><strong>Type:</strong> <span
                                                id="detection-type">-</span></p>
                                        <p style="margin: 5px 0;"><strong>Classification:</strong> <span
                                                id="detection-class">-</span></p>
                                        <p style="margin: 5px 0;"><strong>Confidence:</strong> <span
                                                id="detection-confidence">-</span></p>
                                        <p style="margin: 5px 0;"><strong>Time:</strong> <span
                                                id="detection-time">-</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="no-detection" style="color: #888; text-align: center; padding: 20px;">
                            No detection yet
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Controls & Statistics -->
            <div class="panel control-panel">
                <!-- System Controls -->
                <div class="section">
                    <h2>‚öôÔ∏è System Control</h2>
                    <div class="control-buttons">
                        <button id="btn-start" class="btn btn-primary" onclick="startSystem()">
                            ‚ñ∂Ô∏è Start System
                        </button>
                        <button id="btn-stop" class="btn btn-danger" onclick="stopSystem()">
                            ‚èπÔ∏è Stop System
                        </button>
                    </div>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="label">System Status:</span>
                            <span id="system-status" class="value">Stopped</span>
                        </div>
                        <div class="status-item">
                            <span class="label">Uptime:</span>
                            <span id="uptime" class="value">0s</span>
                        </div>
                    </div>
                </div>

                <!-- Motor Controls -->
                <div class="section">
                    <h2>üîß Motor Control</h2>
                    <div class="control-buttons">
                        <button class="btn btn-success" onclick="controlMotor('start')">
                            Start Motor
                        </button>
                        <button class="btn btn-warning" onclick="controlMotor('stop')">
                            Stop Motor
                        </button>
                    </div>
                    <div class="speed-control">
                        <label for="speed-slider">Speed: <span id="speed-value">60</span>%</label>
                        <input type="range" id="speed-slider" min="0" max="100" value="60"
                            oninput="updateSpeed(this.value)">
                    </div>
                </div>

                <!-- Servo Controls -->
                <div class="section">
                    <h2>üîÑ Servo Control</h2>
                    <div class="servo-buttons">
                        <button class="btn btn-secondary" onclick="controlServo('fresh')">
                            ‚úÖ Fresh (0¬∞ - Straight)
                        </button>
                        <button class="btn btn-secondary" onclick="controlServo('center')">
                            ‚ÜîÔ∏è Center (90¬∞ - Neutral)
                        </button>
                        <button class="btn btn-secondary" onclick="controlServo('spoiled')">
                            ‚ùå Spoiled (180¬∞ - Right)
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="section">
                    <h2>üìä Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-detections">0</div>
                            <div class="stat-label">Total Detected</div>
                        </div>
                        <div class="stat-card fresh">
                            <div class="stat-value" id="fresh-sorted">0</div>
                            <div class="stat-label">Fresh Sorted</div>
                        </div>
                        <div class="stat-card spoiled">
                            <div class="stat-value" id="spoiled-sorted">0</div>
                            <div class="stat-label">Spoiled Sorted</div>
                        </div>
                        <div class="stat-card errors">
                            <div class="stat-value" id="errors">0</div>
                            <div class="stat-label">Errors</div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="resetStats()">
                        Reset Statistics
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Development of a Conveyor System for Fruit Quality Classification Using AI Camera ¬© 2025 </p>
        </footer>
    </div>

    <!-- Image Enlargement Modal -->
    <div id="image-modal"
        style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); cursor: pointer;"
        onclick="closeImageModal()">
        <img id="modal-image" src=""
            style="margin: auto; display: block; max-width: 90%; max-height: 90%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <span
            style="position: absolute; top: 20px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;"
            onclick="closeImageModal()">&times;</span>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>